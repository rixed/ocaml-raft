top_srcdir = @top_srcdir@

PKG_NAME = raft
SOURCES  = \
	log.ml \
	event.ml \
	raft_intf.ml \
	rpc.ml \
	raft.ml

EXAMPLES_BYTE =

REQUIRES = batteries oUnit

EXAMPLES_OPT = $(EXAMPLES_BYTE:.byte=.opt)
EXAMPLES = $(EXAMPLES_BYTE) $(EXAMPLES_OPT)

SYNTAX =

.PHONY: all loc
all: $(XARCHIVE) examples

include $(top_srcdir)/make.common

opt: $(XARCHIVE)

examples: $(XARCHIVE) $(EXAMPLES_OPT)
$(EXAMPLES_BYTE): $(ARCHIVE)
$(EXAMPLES_OPT): $(XARCHIVE)

raft.top: $(ARCHIVE)
	$(OCAMLMKTOP) -o $@ -package "findlib,$(REQUIRES)" -linkpkg $(ARCHIVE)
run: raft.top
	rlwrap ./raft.top -init raft.init

TEST_PROGRAMS = check.ml raft_check.ml
check.cmo: $(ARCHIVE)
raft_check.cmo: $(ARCHIVE)
check-spec: $(TEST_PROGRAMS:.ml=.byte)
	@for p in $^ ; do \
	  ./$$p && echo "$$p OK" || echo "\n     XXXXX $$p FAILED!! XXXXX\n" ;\
	done

clean-spec:

dep-spec:

loc:
	@ls *.ml *.mli -1 | xargs cat | wc -l

